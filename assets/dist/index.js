(()=>{"use strict";var e={338:(e,s,a)=>{var t=a(795);s.H=t.createRoot,t.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},s={},a=function a(t){var n=s[t];if(void 0!==n)return n.exports;var i=s[t]={exports:{}};return e[t](i,i.exports,a),i.exports}(338);const t=window.React,n=window.wp.i18n,i=window.ReactJSXRuntime,o=({className:e="",width:s=189,height:a=36})=>(0,i.jsxs)("svg",{width:s,height:a,viewBox:"0 0 189 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,"aria-label":"EchoDash",children:[(0,i.jsx)("path",{d:"M182.926 12.7229C186.698 12.7229 188.528 14.7598 188.528 18.977V27.4114H184.202V20.1819C184.202 17.6286 183.342 16.7967 181.29 16.7967C178.988 16.7967 177.768 18.0016 177.768 20.4114V27.4114H173.469V7.32947H177.768V16.309H177.851C178.461 14.0426 180.264 12.7229 182.926 12.7229Z",fill:"#202E41"}),(0,i.jsx)("path",{d:"M164.131 27.6983C160.886 27.6983 157.613 26.1491 157.059 23.5385L161.08 22.5344C161.468 23.8827 162.467 24.4565 164.353 24.4565C165.934 24.4565 166.766 24.1122 166.766 23.2803C166.738 22.5057 165.989 22.104 164.408 21.8745L161.801 21.5303C158.945 21.186 157.336 19.5221 157.281 17.1122C157.225 14.2721 159.472 12.7229 163.604 12.7229C167.736 12.7229 170.038 14.3008 170.759 16.9688L166.793 17.8581C166.544 16.4237 165.434 15.7352 163.77 15.7352C162.328 15.7352 161.579 16.1368 161.579 16.9401C161.579 17.5999 162.245 18.1163 163.632 18.2598L166.682 18.5754C169.373 18.8622 171.037 20.4975 171.092 22.8786C171.148 26.0057 168.652 27.6983 164.131 27.6983Z",fill:"#202E41"}),(0,i.jsx)("path",{d:"M147.792 12.7229C151.841 12.7229 154.837 14.5877 154.837 18.2024V27.4114H151.148L150.649 24.4278H150.565C149.761 26.5508 147.986 27.6983 145.296 27.6983C142.134 27.6983 140.082 26.1491 140.082 23.768C140.082 20.9565 141.607 19.9524 149.29 18.7475L150.676 18.518L150.649 17.9729C150.51 16.5672 149.623 16.1942 147.737 16.1942C145.573 16.1942 144.63 16.9688 144.547 18.518L140.997 17.5999C141.164 14.3581 144.325 12.7229 147.792 12.7229ZM146.738 24.6286C148.901 24.6286 150.621 22.6778 150.676 20.8418L149.484 21.0426C146.378 21.645 144.353 22.1327 144.353 23.309C144.353 24.1696 145.157 24.6286 146.738 24.6286Z",fill:"#202E41"}),(0,i.jsx)("path",{d:"M118.471 27.4114V7.32947H128.705C135.139 7.32947 138.772 11.2885 138.772 17.3705C138.772 23.5098 135.083 27.4114 128.705 27.4114H118.471ZM122.991 23.1082H128.594C132.782 23.1082 134.14 21.7024 134.14 17.3705C134.14 13.0385 132.782 11.6041 128.594 11.6041H122.991V23.1082Z",fill:"#202E41"}),(0,i.jsx)("path",{d:"M107.177 27.6983C102.462 27.6983 98.8848 25.0303 98.8848 20.2393C98.8848 15.4196 102.518 12.7229 107.177 12.7229C111.975 12.7229 115.47 15.4483 115.47 20.2393C115.47 25.0877 111.864 27.6983 107.177 27.6983ZM107.177 23.6245C109.784 23.6245 111.143 22.7639 111.143 20.2393C111.143 17.8581 110.173 16.7967 107.177 16.7967C104.293 16.7967 103.211 17.8581 103.211 20.2393C103.211 22.8213 104.626 23.6245 107.177 23.6245Z",fill:"#202E41"}),(0,i.jsx)("path",{d:"M90.7854 12.7229C94.5573 12.7229 96.3877 14.7598 96.3877 18.977V27.4114H92.0612V20.1819C92.0612 17.6286 91.2014 16.7967 89.1491 16.7967C86.8472 16.7967 85.6269 18.0016 85.6269 20.4114V27.4114H81.3281V7.32947H85.6269V16.309H85.7101C86.3202 14.0426 88.123 12.7229 90.7854 12.7229Z",fill:"#202E41"}),(0,i.jsx)("path",{d:"M71.4833 27.6983C66.4634 27.6983 63.1076 24.9442 63.1076 20.2393C63.1076 15.4483 66.4912 12.7229 71.4833 12.7229C75.9762 12.7229 78.3613 14.6737 79.2488 18.4893L75.0887 19.4647C74.7282 17.5713 73.6465 16.7967 71.4833 16.7967C68.5435 16.7967 67.4064 17.8581 67.4064 20.2393C67.4064 22.5918 68.5435 23.6245 71.4833 23.6245C73.8961 23.6245 74.6727 22.8213 75.0887 20.9565L79.2488 21.9319C78.3336 25.7762 75.9207 27.6983 71.4833 27.6983Z",fill:"#202E41"}),(0,i.jsx)("path",{d:"M61.0768 11.6041H50.621V14.9893H60.1615V19.1205H50.621V23.1368H61.0768V27.4114H46.1836V7.32947H61.0768V11.6041Z",fill:"#202E41"}),(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.50689 4.31251C10.4771 4.31415 13.1988 5.37832 15.3125 7.14551C10.4262 7.4671 6.56249 11.5323 6.56249 16.5C6.56249 21.4677 10.4262 25.5329 15.3125 25.8545C13.1972 27.6231 10.4729 28.6875 7.5 28.6875L5.62191 28.6875C4.07003 28.6858 2.81251 27.4273 2.81251 25.875L2.8125 7.125C2.8125 5.5717 4.0717 4.31251 5.625 4.31251L7.49999 4.3125L7.50689 4.31251ZM27.1875 16.5C27.1875 10.2246 22.4446 5.05701 16.348 4.38621C20.0776 7.11502 22.5 11.5246 22.5 16.5C22.5 21.4754 20.0776 25.885 16.348 28.6138C22.4446 27.943 27.1875 22.7754 27.1875 16.5ZM7.50764 1.50001L15 1.50001C23.2843 1.50001 30 8.21573 30 16.5C30 24.7843 23.2843 31.5 15 31.5L7.5 31.5L5.625 31.5L4.21874 31.5C1.88879 31.5 -3.89726e-06 29.6112 -3.9991e-06 27.2813L-4.94163e-06 5.71876C-5.04348e-06 3.3888 1.88879 1.50001 4.21874 1.5L5.625 1.50001L7.49999 1.5L7.50764 1.50001ZM17.6367 9.9375L15.9375 9.9375C12.3131 9.9375 9.37499 12.8756 9.37499 16.5C9.37499 20.1244 12.3131 23.0625 15.9375 23.0625L17.6367 23.0625C17.7338 23.0625 17.8125 22.9838 17.8125 22.8867L17.8125 20.25L15.9375 20.25C13.8664 20.25 12.1875 18.5711 12.1875 16.5C12.1875 14.4289 13.8664 12.75 15.9375 12.75L17.8125 12.75L17.8125 10.1133C17.8125 10.0162 17.7338 9.9375 17.6367 9.9375ZM15.9375 15.5625L17.3437 15.5625L17.3437 17.4375L15.9375 17.4375C15.4197 17.4375 15 17.0178 15 16.5C15 15.9822 15.4197 15.5625 15.9375 15.5625Z",fill:"#202E41"})]}),r=({integrations:e,settings:s,onIntegrationClick:a,onAddTrigger:r})=>{const[c,d]=(0,t.useState)(s.endpoint||""),[l,h]=(0,t.useState)(s.endpoint||""),[g,m]=(0,t.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"echodash-header",children:[(0,i.jsx)("a",{href:"https://echodash.com/?utm_source=echodash-plugin&utm_medium=plugin&utm_campaign=echodash-plugin",target:"_blank",rel:"noopener",className:"echodash-header__logo-link",children:(0,i.jsx)(o,{className:"echodash-header__logo"})}),(0,i.jsxs)("a",{href:"https://echodash.com/docs/echodash-plugin/?utm_source=echodash-plugin&utm_medium=plugin&utm_campaign=echodash-plugin",target:"_blank",rel:"noopener",className:"echodash-button echodash-header__docs-link",children:[(0,n.__)("Documentation","echodash")," →"]})]}),(0,i.jsxs)("div",{className:"echodash-card echodash-welcome",children:[(0,i.jsxs)("div",{className:"echodash-welcome__content",children:[(0,i.jsx)("h2",{className:"echodash-welcome__title",children:(0,n.__)("Welcome to EchoDash","echodash")}),(0,i.jsx)("p",{className:"echodash-welcome__description",children:(0,n.__)("EchoDash is a service for tracking real-time events on your WordPress site. It's free and easy to use.","echodash")}),s.isConnected?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{className:"echodash-welcome__instructions",children:(0,n.__)("Your endpoint URL is configured below. You can update it anytime if needed.","echodash")}),(0,i.jsxs)("div",{className:"echodash-welcome__field-group echodash-input-wrapper echodash-input-wrapper--endpoint-url",children:[(0,i.jsx)("input",{type:"text",id:"endpoint-url",className:"echodash-input-base echodash-welcome__input",placeholder:(0,n.__)("https://echodash.com/endpoints/xyz/receive","echodash"),value:c,onChange:e=>{d(e.target.value)},onBlur:async()=>{if(c!==l){if(!window.ecdReactData?.apiUrl)return void alert((0,n.__)("Configuration error: API URL not available. Please refresh the page and try again.","echodash"));m(!0);try{if(!(await fetch(window.ecdReactData.apiUrl+"settings",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.ecdReactData?.nonce||""},body:JSON.stringify({endpoint:c})})).ok)throw new Error("Failed to save endpoint");h(c)}catch{d(l),alert((0,n.__)("Failed to save endpoint URL. Please try again.","echodash"))}finally{m(!1)}}},disabled:g}),g&&(0,i.jsx)("span",{className:"echodash-saving-indicator",children:(0,n.__)("Saving...","echodash")})]}),(0,i.jsxs)("a",{href:"https://echodash.com/events/?utm_source=echodash-plugin&utm_medium=plugin&utm_campaign=echodash-plugin",target:"_blank",rel:"noopener",className:"echodash-button echodash-button-primary",children:[(0,n.__)("View events","echodash")," →"]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{className:"echodash-welcome__instructions",children:(0,n.__)("To get started, create an endpoint in your EchoDash account by clicking the button below.","echodash")}),(0,i.jsx)("div",{className:"echodash-welcome__connect-action",children:(0,i.jsxs)("a",{href:s.connectUrl||"#",className:"echodash-button echodash-button-primary echodash-connect-button",children:[(0,n.__)("Connect to EchoDash","echodash")," ","→"]})})]})]}),(0,i.jsx)("div",{className:"echodash-video-placeholder",children:(0,i.jsx)("div",{className:"echodash-video-placeholder__play-button",children:(0,i.jsx)("span",{className:"dashicons dashicons-controls-play echodash-video-placeholder__play-icon"})})})]}),(0,i.jsxs)("div",{className:"echodash-card echodash-integrations",children:[(0,i.jsx)("h2",{className:"echodash-integrations__title",children:(0,n.__)("Integrations","echodash")}),(0,i.jsx)("div",{className:"echodash-integrations__list",children:e.map(e=>(0,i.jsxs)("div",{className:"echodash-integration-item",children:[(0,i.jsx)("div",{className:"echodash-integration-item__icon",style:{backgroundColor:e.iconBackgroundColor},children:(0,i.jsx)("img",{src:e.icon,alt:`${e.name} logo`,className:"echodash-integration-item__icon-image"})}),(0,i.jsxs)("div",{className:"echodash-integration-item__info",children:[(0,i.jsx)("h3",{className:"echodash-integration-item__name",children:e.name}),(0,i.jsxs)("span",{className:"echodash-integration-item__trigger-count",children:[e.triggerCount," ",1===e.triggerCount?(0,n.__)("Trigger","echodash"):(0,n.__)("Triggers","echodash")]})]}),(0,i.jsxs)("div",{className:"echodash-integration-item__actions",children:[(0,i.jsx)("button",{className:"echodash-button",onClick:()=>a(e.slug),children:(0,n.__)("Manage","echodash")}),(0,i.jsxs)("button",{className:"echodash-button",onClick:()=>r(e.slug),children:["+ ",(0,n.__)("Add Trigger","echodash")]})]})]},e.slug))})]})]})},c=({integration:e,triggers:s,onBack:a,onAddTrigger:r,onEditTrigger:c,onDeleteTrigger:d,onSendTest:l,deletingTrigger:h})=>{const[g,m]=(0,t.useState)(null),[u,p]=(0,t.useState)(null);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"echodash-header",children:[(0,i.jsx)("a",{href:"https://echodash.com/?utm_source=echodash-plugin&utm_medium=plugin&utm_campaign=echodash-plugin",target:"_blank",rel:"noopener noreferrer",className:"echodash-header__logo-link",children:(0,i.jsx)(o,{className:"echodash-header__logo"})}),(0,i.jsxs)("a",{href:"https://echodash.com/docs/echodash-plugin/?utm_source=echodash-plugin&utm_medium=plugin&utm_campaign=echodash-plugin",target:"_blank",rel:"noopener noreferrer",className:"echodash-button echodash-header__docs-link",children:[(0,n.__)("Documentation","echodash")," →"]})]}),(0,i.jsxs)("div",{className:"echodash-breadcrumb",children:[(0,i.jsx)("button",{onClick:a,className:"button-link echodash-breadcrumb__link",children:(0,n.__)("Integrations","echodash")}),(0,i.jsx)("span",{className:"echodash-breadcrumb__separator",children:"/"}),(0,i.jsx)("span",{children:e.name})]}),(0,i.jsx)("div",{className:"echodash-card echodash-integration-header",children:(0,i.jsxs)("div",{className:"echodash-integration-header__content",children:[(0,i.jsx)("div",{className:"echodash-integration-header__icon echodash-integration-item__icon",style:{backgroundColor:e.iconBackgroundColor},children:(0,i.jsx)("img",{src:e.icon,alt:`${e.name} logo`,className:"echodash-integration-header__icon-image echodash-integration-item__icon-image"})}),(0,i.jsxs)("div",{className:"echodash-integration-header__info",children:[(0,i.jsx)("h1",{className:"echodash-integration-header__title",children:e.name}),(0,i.jsx)("p",{className:"echodash-integration-header__description",children:e.description||(0,n.__)("Configure triggers for this integration","echodash")})]}),(0,i.jsxs)("button",{className:"echodash-button echodash-integration-header__add-trigger",onClick:r,children:["+ ",(0,n.__)("Add Trigger","echodash")]})]})}),(0,i.jsxs)("div",{className:"echodash-card echodash-triggers",children:[(0,i.jsx)("h2",{className:"echodash-triggers__title",children:(0,n.__)("Global Triggers","echodash")}),0===s.length?(0,i.jsxs)("div",{className:"echodash-triggers__empty-state",children:[(0,i.jsx)("div",{className:"echodash-triggers__empty-icon echodash-integration-item__icon",style:{backgroundColor:e.iconBackgroundColor},children:(0,i.jsx)("img",{src:e.icon,alt:`${e.name} logo`,className:"echodash-triggers__empty-icon-image echodash-integration-item__icon-image"})}),(0,i.jsx)("h3",{className:"echodash-triggers__empty-title",children:(0,n.__)("Add your first %s trigger","echodash").replace("%s",e.name)}),(0,i.jsx)("p",{className:"echodash-triggers__empty-description",children:"Global triggers fire for all events of the selected type across your site."}),(0,i.jsxs)("button",{className:"echodash-button echodash-button-primary",onClick:r,children:["+ ",(0,n.__)("Add Trigger","echodash")]})]}):(0,i.jsx)("div",{className:"echodash-triggers__list",children:s.map((e,s)=>(0,i.jsxs)("div",{className:"echodash-trigger-item echodash-integration-item",children:[(0,i.jsx)("span",{className:"dashicons dashicons-menu echodash-trigger-item__handle"}),(0,i.jsxs)("div",{className:"echodash-trigger-item__info",children:[(0,i.jsx)("div",{className:"echodash-trigger-item__type",children:e.name}),(0,i.jsx)("div",{className:"echodash-trigger-item__name",children:e.description||e.trigger||(0,n.__)("Trigger","echodash")})]}),(0,i.jsxs)("div",{className:"echodash-trigger-item__actions",children:[(0,i.jsx)("button",{className:"echodash-button",onClick:()=>(async e=>{m(e.id),p(null);try{await l(e),p(e.id),setTimeout(()=>p(null),3e3)}catch{}finally{m(null)}})(e),disabled:g===e.id||h===e.id,children:g===e.id?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"dashicons dashicons-bell ecd-ring"}),"Sending..."]}):u===e.id?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"dashicons dashicons-bell"}),"Sent!"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"dashicons dashicons-bell"}),"Send Test"]})}),(0,i.jsx)("button",{className:"echodash-button",onClick:()=>c(e),disabled:h===e.id,children:"Edit"}),(0,i.jsx)("button",{className:"echodash-button",onClick:()=>{window.confirm((0,n.__)('Are you sure you want to delete the "%s" trigger? This action cannot be undone.',"echodash").replace("%s",e.name||(0,n.__)("Untitled","echodash")))&&d(e)},title:"Delete trigger",disabled:h===e.id,children:h===e.id?(0,i.jsx)("span",{className:"dashicons dashicons-update-alt ecd-spinner"}):(0,i.jsx)("span",{className:"dashicons dashicons-trash"})})]})]},e.id||s))})]}),e.singleItemTriggers&&e.singleItemTriggers.length>0&&(0,i.jsxs)("div",{className:"echodash-card echodash-single-triggers",children:[(0,i.jsx)("h2",{className:"echodash-triggers__title",children:"Single-Item Events"}),(0,i.jsx)("p",{className:"echodash-single-triggers__description",children:"These events are configured on individual posts, forms, products, or courses."}),e.singleItemTriggers.map((e,s)=>(0,i.jsxs)("div",{className:"echodash-single-trigger-group",children:[(0,i.jsx)("h3",{className:"echodash-single-trigger-group__title",children:e.name}),(0,i.jsx)("p",{className:"echodash-single-trigger-group__description",children:e.description}),(0,i.jsx)("div",{className:"echodash-single-triggers__list",children:e.items.map((e,s)=>(0,i.jsxs)("div",{className:"echodash-single-trigger-item echodash-integration-item",children:[(0,i.jsxs)("div",{className:"echodash-single-trigger-item__info",children:[(0,i.jsx)("div",{className:"echodash-single-trigger-item__title",children:e.event_name||(0,n.__)("Untitled Event","echodash")}),(0,i.jsxs)("div",{className:"echodash-single-trigger-item__post",children:[(0,n.__)("Configured on:","echodash")," ",(0,i.jsx)("strong",{children:e.post_title})]})]}),(0,i.jsx)("div",{className:"echodash-single-trigger-item__actions",children:(0,i.jsxs)("a",{href:e.edit_url,className:"echodash-button",target:"_blank",rel:"noopener noreferrer",children:[(0,n.__)("Edit Item","echodash")," ","→"]})})]},`${e.post_id}-${s}`))})]},`${e.trigger}-${s}`))]})]})},d=({options:e,onSelect:s,isOpen:a,onClose:n,buttonRef:o})=>{const r=(0,t.useRef)(null),c=(0,t.useRef)(null),[d,l]=(0,t.useState)({top:0,left:0}),[h,g]=(0,t.useState)(!1),[m,u]=(0,t.useState)(""),[p,_]=(0,t.useState)(-1);(0,t.useEffect)(()=>{if(a&&o.current){const e=o.current.getBoundingClientRect(),s=o.current.closest(".echodash-modal");if(g(!!s),s){let s=e.bottom+2,a=e.left;setTimeout(()=>{if(r.current){const t=r.current.getBoundingClientRect();a+t.width>window.innerWidth-20&&(a=e.right-t.width),s+t.height>window.innerHeight-20&&(s=e.top-t.height-2),l({top:s,left:a})}},0),l({top:s,left:a})}else{const s=e.bottom+window.scrollY+2,a=e.left+window.scrollX;l({top:s,left:a})}}},[a,o]),(0,t.useEffect)(()=>{const e=e=>{r.current&&!r.current.contains(e.target)&&o.current&&!o.current.contains(e.target)&&n()};if(a)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[a,n,o]),(0,t.useEffect)(()=>{a&&c.current&&setTimeout(()=>{c.current?.focus()},100),a||(u(""),_(-1))},[a]);const v=(0,t.useMemo)(()=>{if(!m.trim())return e;const s=m.toLowerCase();return e.map(e=>({...e,options:e.options.filter(a=>{var t,n;const i=`{${e.type}:${a.meta}}`.toLowerCase(),o=String(null!==(t=a.placeholder)&&void 0!==t?t:"").toLowerCase(),r=String(null!==(n=a.preview)&&void 0!==n?n:"").toLowerCase();return i.includes(s)||o.includes(s)||r.includes(s)})})).filter(e=>e.options.length>0)},[e,m]);(0,t.useEffect)(()=>{if(p>=0&&r.current){const e=r.current.querySelector(".echodash-merge-dropdown__content"),s=e?.querySelector(".echodash-merge-dropdown__option--focused");if(s&&e){const a=e.getBoundingClientRect(),t=s.getBoundingClientRect();t.bottom>a.bottom?e.scrollTop+=t.bottom-a.bottom+5:t.top<a.top&&(e.scrollTop-=a.top-t.top+5)}}},[p]);const x=(0,t.useMemo)(()=>{const e=[];return v.forEach(s=>{s.options.forEach(a=>{e.push({groupType:s.type,meta:a.meta,groupName:s.name,option:a})})}),e},[v]),f=(e,a)=>{s(`{${e}:${a}}`),n()};return a?(0,i.jsxs)("div",{ref:r,className:"echodash-merge-dropdown "+(h?"echodash-merge-dropdown--in-modal":""),style:{position:h?"fixed":"absolute",top:d.top,left:d.left},children:[(0,i.jsx)("div",{className:"echodash-merge-dropdown__search",children:(0,i.jsx)("input",{ref:c,type:"text",placeholder:"Search merge tags...",value:m,onChange:e=>u(e.target.value),className:"echodash-merge-dropdown__search-input",onKeyDown:e=>{"ArrowDown"===e.key&&x.length>0?(e.preventDefault(),_(0)):"Escape"===e.key?(e.preventDefault(),n()):e.stopPropagation()}})}),(0,i.jsxs)("div",{className:"echodash-merge-dropdown__content",onKeyDown:e=>{switch(e.key){case"ArrowDown":e.preventDefault(),_(e=>e<x.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),_(e=>e>0?e-1:-1),0===p&&c.current?.focus();break;case"Enter":if(e.preventDefault(),p>=0&&p<x.length){const e=x[p];f(e.groupType,e.meta)}break;case"Escape":e.preventDefault(),n()}},role:"listbox",tabIndex:-1,children:[v.map((e,s)=>{let a=0;for(let e=0;e<s;e++)a+=v[e].options.length;return(0,i.jsxs)("div",{className:"echodash-merge-dropdown__group",children:[(0,i.jsx)("div",{className:"echodash-merge-dropdown__group-header",children:e.name}),e.options.map((s,t)=>{const n=p===a+t;return(0,i.jsxs)("div",{onClick:()=>f(e.type,s.meta),onKeyDown:a=>{"Enter"!==a.key&&" "!==a.key||(a.preventDefault(),f(e.type,s.meta))},tabIndex:n?0:-1,role:"button","aria-label":`Select merge tag ${e.type}:${s.meta}`,className:"echodash-merge-dropdown__option "+(n?"echodash-merge-dropdown__option--focused":""),children:[(0,i.jsx)("div",{className:"echodash-merge-dropdown__option-tag",children:`{${e.type}:${s.meta}}`}),(0,i.jsx)("div",{className:"echodash-merge-dropdown__option-placeholder",children:s.placeholder}),(0,i.jsxs)("div",{className:"echodash-merge-dropdown__option-preview",children:["Preview: ",String(s.preview)]})]},t)})]},s)}),0===v.length&&(0,i.jsx)("div",{className:"echodash-merge-dropdown__empty",children:m.trim()?"No matching merge tags found":"No merge tags available"})]})]}):null},l=({isOpen:e,onClose:s,onSave:a,onSendTest:o,integration:r,editingTrigger:c,savingTrigger:l=!1})=>{const h=r.availableTriggers&&r.availableTriggers.length>0?r.availableTriggers:[{id:"form_submitted",name:"Form Submitted",description:"Triggered each time a form is submitted."}],[g,m]=(0,t.useState)(c?c.trigger||c.id||"":h[0]?.id||""),[u,p]=(0,t.useState)((()=>{if(c)return c.name||c.event_name||"";const e=h[0];return e?.defaultEvent?.name||e?.name||""})()),[_,v]=(0,t.useState)((()=>{if(c?.mappings&&Array.isArray(c.mappings)){const e=c.mappings.map(e=>({key:e.key||"",value:e.value||""}));return 0!==e.length&&""===e[e.length-1].key&&""===e[e.length-1].value||e.push({key:"",value:""}),e}if(!c){const e=h[0];if(e?.defaultEvent?.mappings&&"object"==typeof e.defaultEvent.mappings){const s=Object.entries(e.defaultEvent.mappings).map(([e,s])=>({key:e,value:String(s)}));return s.push({key:"",value:""}),s}}return[{key:"user_name",value:"{user_name}"},{key:"user_id",value:"{user_id}"},{key:"",value:""}]})()),[x,f]=(0,t.useState)(null),[j,N]=(0,t.useState)(!1),[b,y]=(0,t.useState)(!1),w=(0,t.useRef)(null),C=(0,t.useRef)([]);if((0,t.useEffect)(()=>{C.current=C.current.slice(0,_.length)},[_.length]),!e)return null;const k=(e,s,a)=>{const t=[..._];t[e][s]=a,v(t)},S=()=>{v([..._,{key:"",value:""}])};return(0,i.jsx)("div",{className:"echodash-modal-overlay",children:(0,i.jsxs)("div",{className:"echodash-modal",role:"dialog","aria-modal":"true",tabIndex:-1,children:[(0,i.jsxs)("div",{className:"echodash-modal__header",children:[(0,i.jsxs)("div",{className:"echodash-modal__header-content",children:[(0,i.jsx)("div",{className:"echodash-modal__header-icon echodash-integration-item__icon",style:{backgroundColor:r.iconBackgroundColor||"#ff6900"},children:r.icon?(0,i.jsx)("img",{src:r.icon,alt:`${r.name} logo`,className:"echodash-modal__header-icon-image"}):(0,i.jsx)("span",{className:`dashicons dashicons-${"gravity-forms"===r.slug?"feedback":"admin-plugins"} echodash-modal__header-icon-dashicon`})}),(0,i.jsxs)("div",{className:"echodash-modal__header-text",children:[(0,i.jsx)("h2",{className:"echodash-modal__title",children:c?"Edit Trigger":"Add Trigger"}),(0,i.jsx)("p",{className:"echodash-modal__subtitle",children:c?(0,n.__)("Edit trigger for %s","echodash").replace("%s",r.name):(0,n.__)("Create a trigger for %s","echodash").replace("%s",r.name)})]})]}),(0,i.jsx)("button",{onClick:s,className:"echodash-modal__close",children:(0,i.jsx)("span",{className:"dashicons dashicons-no-alt"})})]}),(0,i.jsxs)("div",{className:"echodash-modal__content",children:[(0,i.jsxs)("div",{className:"echodash-form-group",children:[(0,i.jsx)("label",{className:"echodash-form-group__label",children:(0,n.__)("Trigger","echodash")}),(0,i.jsx)("select",{value:g,onChange:e=>(e=>{m(e);const s=h.find(s=>s.id===e);if(s&&(p(s.defaultEvent?.name||s.name),s.defaultEvent?.mappings&&"object"==typeof s.defaultEvent.mappings)){const e=Object.entries(s.defaultEvent.mappings).map(([e,s])=>({key:e,value:String(s)}));e.push({key:"",value:""}),v(e)}})(e.target.value),className:"echodash-form-group__select",disabled:!!c||l,children:h.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))}),g&&(0,i.jsxs)("div",{className:"echodash-info-box",children:[(0,i.jsx)("span",{className:"dashicons dashicons-info-outline echodash-info-box__icon"}),(0,i.jsx)("span",{className:"echodash-info-box__text",children:h.find(e=>e.id===g)?.description||"No description available."})]})]}),(0,i.jsx)("hr",{}),(0,i.jsxs)("div",{className:"echodash-payload",children:[(0,i.jsx)("h3",{className:"echodash-payload__title",children:"Payload"}),(0,i.jsx)("div",{className:"echodash-event-name",children:(0,i.jsxs)("div",{className:"echodash-input-wrapper echodash-input-wrapper--name",children:[(0,i.jsx)("input",{type:"text",value:u,onChange:e=>p(e.target.value),className:"echodash-event-name__input",disabled:l}),(0,i.jsx)("button",{ref:w,type:"button",onClick:()=>f({type:"name",index:-1}),className:"echodash-merge-tag-button echodash-merge-tag-button--inline",disabled:l})]})}),_.map((e,s)=>(0,i.jsxs)("div",{className:"echodash-key-value-pair",children:[(0,i.jsx)("div",{className:"echodash-key-value-pair__field echodash-key-value-pair__field--key",children:(0,i.jsx)("div",{className:"echodash-input-wrapper echodash-input-wrapper--key",children:(0,i.jsx)("input",{type:"text",value:e.key,onChange:e=>k(s,"key",e.target.value),className:"echodash-key-value-pair__input",disabled:l})})}),(0,i.jsx)("div",{className:"echodash-key-value-pair__field echodash-key-value-pair__field--value",children:(0,i.jsxs)("div",{className:"echodash-input-wrapper echodash-input-wrapper--value",children:[(0,i.jsx)("input",{type:"text",value:e.value,onChange:e=>k(s,"value",e.target.value),className:"echodash-key-value-pair__input",disabled:l}),(0,i.jsx)("button",{ref:e=>{C.current&&(C.current[s]=e)},type:"button",onClick:()=>f({type:"value",index:s}),className:"echodash-merge-tag-button echodash-merge-tag-button--inline",disabled:l})]})}),(0,i.jsxs)("div",{className:"echodash-key-value-pair__actions",children:[(0,i.jsx)("button",{type:"button",onClick:S,className:"echodash-key-value-pair__action-button",disabled:l,children:(0,i.jsx)("span",{className:"dashicons dashicons-plus-alt2"})}),_.length>1&&(0,i.jsx)("button",{type:"button",onClick:()=>(e=>{if(_.length>1){const s=_.filter((s,a)=>a!==e);v(s)}})(s),className:"echodash-key-value-pair__action-button",disabled:l,children:(0,i.jsx)("span",{className:"dashicons dashicons-minus"})})]})]},s))]})]}),x&&(0,i.jsx)(d,{options:(()=>{const e=h.find(e=>e.id===g);return e?.options||[]})(),onSelect:e=>{if("name"===x?.type)p(s=>s+e);else if("value"===x?.type){const s=x.index;k(s,"value",_[s].value+e)}f(null)},isOpen:!0,onClose:()=>f(null),buttonRef:"name"===x.type?w:{current:C.current[x.index]}}),(0,i.jsxs)("div",{className:"echodash-modal__footer",children:[(0,i.jsx)("button",{type:"button",className:"echodash-button echodash-send-test-button",onClick:async()=>{if(o){N(!0),y(!1);try{const e={trigger:g,name:u,mappings:_.filter(e=>e.key&&e.value)};await o(e),y(!0),setTimeout(()=>y(!1),3e3)}catch{}finally{N(!1)}}},disabled:j||!o||!g||l,children:j?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"dashicons dashicons-bell ecd-ring"}),"Sending..."]}):b?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"dashicons dashicons-bell"}),"Sent!"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"dashicons dashicons-bell"}),"Send Test"]})}),(0,i.jsxs)("div",{className:"echodash-modal__footer-actions",children:[(0,i.jsx)("button",{onClick:s,className:"echodash-button",disabled:l,children:"Cancel"}),(0,i.jsx)("button",{onClick:()=>{const e={trigger:g,name:u,mappings:_.filter(e=>e.key&&e.value)};a(e)},className:"echodash-button echodash-button-primary",disabled:!g||l,children:l?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"dashicons dashicons-update-alt ecd-spinner"}),"Saving..."]}):c?"Update Trigger":"Add Trigger"})]})]})]})})},h=()=>{const[e,s]=(0,t.useState)("list"),[a,n]=(0,t.useState)(null),[o,d]=(0,t.useState)(!1),[h,g]=(0,t.useState)(null),[m,u]=(0,t.useState)(window.ecdReactData?.userTriggers||{}),[p,_]=(0,t.useState)(window.ecdReactData?.integrations||[]),[v,x]=(0,t.useState)(!1),[f,j]=(0,t.useState)(null),N=window.ecdReactData||{settings:{},integrations:[],userTriggers:{},nonce:"",apiUrl:"",i18n:{}};(0,t.useEffect)(()=>{if("list"===e)window.history.pushState({},"",window.location.pathname+window.location.search);else if("detail"===e&&a){const e=new URL(window.location.href||"http://localhost/");e.hash=`/integration/${a}`,window.history.pushState({},"",e.toString())}},[e,a]),(0,t.useEffect)(()=>{const e=()=>{const e=window.location.hash;if(e.startsWith("#/integration/")){const a=e.replace("#/integration/","");n(a),s("detail")}else s("list"),n(null)};return window.addEventListener("popstate",e),e(),()=>window.removeEventListener("popstate",e)},[]),(0,t.useEffect)(()=>{const e=new URLSearchParams(window.location.search),s=e.get("endpoint_url"),a=e.get("wpnonce");s&&a&&window.location.reload()},[]);const b=async e=>{try{const s={name:e.name||e.event_name,mappings:e.mappings||[]},t=await fetch(`${N.apiUrl}preview`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":N.nonce},body:JSON.stringify({eventConfig:s,integrationSlug:a,triggerId:e.trigger})});if(!t.ok)throw new Error("Failed to generate event preview");const n=await t.json(),i={name:n.eventName,properties:n.processedData},o=await fetch(`${N.apiUrl}test-event`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":N.nonce},body:JSON.stringify({eventData:i,integrationSlug:a,trigger:e.trigger})});if(o.ok)return;{const e=await o.json();throw new Error(e.message||"Failed to send test event. Please try again.")}}catch(e){const s=e instanceof Error?e.message:"Error sending test event. Please check your connection and try again.";alert(s)}},y=p.find(e=>e.slug===a);return(0,i.jsxs)("div",{className:"wrap",children:["list"===e?(0,i.jsx)(r,{integrations:p,settings:N.settings,onIntegrationClick:e=>{n(e),s("detail")},onAddTrigger:e=>{n(e),s("detail"),setTimeout(()=>{g(null),d(!0)},50)}}):y&&a&&(0,i.jsx)(c,{integration:{...y,singleItemTriggers:m[a]?.singleItem||[]},triggers:m[a]?.global||[],onBack:()=>{s("list"),n(null)},onAddTrigger:()=>{g(null),d(!0)},onEditTrigger:e=>{g(e),d(!0)},onDeleteTrigger:async e=>{j(e.id);try{const s=`${N.apiUrl}integrations/${a}/triggers/${e.id}`,t=await fetch(s,{method:"DELETE",headers:{"X-WP-Nonce":N.nonce}});if(!t.ok){const e=await t.json();throw new Error(e.message||"Failed to delete trigger. Please try again.")}if(a){const s=(m[a]?.global||[]).filter(s=>s.id!==e.id);u(e=>({...e,[a]:{global:s,singleItem:e[a]?.singleItem||[]}})),_(e=>e.map(e=>e.slug===a?{...e,triggerCount:Math.max(0,e.triggerCount-1)}:e))}}catch(e){const s=e instanceof Error?e.message:"Error deleting trigger. Please check your connection and try again.";alert(s)}finally{j(null)}},onSendTest:b,deletingTrigger:f}),o&&y&&(0,i.jsx)(l,{isOpen:o,onClose:()=>{d(!1),g(null)},onSave:async e=>{x(!0);try{const s=null!==h,t=s?`${N.apiUrl}integrations/${a}/triggers/${h.id}`:`${N.apiUrl}integrations/${a}/triggers`,n=await fetch(t,{method:s?"PUT":"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":N.nonce},body:JSON.stringify({trigger:e.trigger,name:e.name,event_name:e.name,mappings:e.mappings,send_test:e.sendTest})});if(!n.ok){const e=await n.json();throw new Error(e.message||"Failed to save trigger. Please try again.")}{const t=await n.json();if(a){const n=m[a]?.global||[],i=m[a]?.singleItem||[],o=p.find(e=>e.slug===a),r=o?.availableTriggers?.find(s=>s.id===e.trigger),c=r?.description||"";if(s)if(n.some(e=>e.id===h.id)){const s=n.map(s=>s.id===h.id?{...s,id:t.id||h.id,name:e.name,trigger:e.trigger,event_name:e.name,mappings:e.mappings,description:c,enabled:!0}:s);u(e=>({...e,[a]:{global:s,singleItem:i}}))}else{const s=i.map(s=>({...s,items:s.items.map(s=>s.post_id.toString()===h.id?{...s,event_name:e.name,mappings:e.mappings}:s)}));u(e=>({...e,[a]:{global:n,singleItem:s}}))}else{const s={id:t.id||Date.now().toString(),name:e.name,trigger:e.trigger,event_name:e.name,mappings:e.mappings,description:c,enabled:!0};u(e=>({...e,[a]:{global:[...n,s],singleItem:i}})),_(e=>e.map(e=>e.slug===a?{...e,triggerCount:e.triggerCount+1,enabled:!0}:e))}}d(!1),g(null)}}catch(e){const s=e instanceof Error?e.message:"Error saving trigger. Please check your connection and try again.";alert(s)}finally{x(!1)}},onSendTest:b,integration:y,editingTrigger:h,savingTrigger:v})]})};function g(){try{const e=document.getElementById("echodash-react-app");if(e){(0,a.H)(e).render((0,i.jsx)(h,{})),e.classList.add("loaded");const s=document.getElementById("echodash-loading");s&&(s.style.display="none")}}catch{}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g()})();
//# sourceMappingURL=index.js.map